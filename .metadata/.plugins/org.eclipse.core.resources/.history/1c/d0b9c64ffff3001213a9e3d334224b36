package br.usp.ime.tcc.filter;

import android.graphics.Bitmap;
import android.graphics.Color;

public class Filter {
	private double alpha;
	private double beta;
	private double gama;

	public Filter(double intensity) {
		alpha = calculaAlpha(intensity);
		beta = calculaBeta(intensity);
		gama = 1 - (alpha + beta);
	}

	private double calculaAlpha(double intensity) {
		return intensity >= 0 ? 0 : -intensity;
	}

	private double calculaBeta(double intensity) {
		return calculaAlpha(-intensity);
	}
	
	private int calculateNewBlue(int originalRed, int originalGreen,
			int originalBlue) {
		int newBlue = (int) ((originalBlue * gama)
				+ (originalRed * gama) + (originalGreen * beta));
		return newBlue;
	}

	public Bitmap applyTo(Bitmap bmp) {
		if (bmp == null)
			return null;
		
		int width = bmp.getWidth();
		int height = bmp.getHeight();

		Bitmap filtered = Bitmap.createBitmap(bmp);

		for (int w = 0; w < width; w++) {
			for (int h = 0; h < height; h++) {
				int pixel = bmp.getPixel(w, h);

				int originalRed = (int) (Color.red(pixel) * 1.0);
				int originalGreen = (int) (Color.green(pixel) * 1.0);
				int originalBlue = (int) (Color.blue(pixel) * 1.0);

				int newBlue = calculateNewBlue(originalRed, originalGreen,
						originalBlue);

				filtered.setPixel(w, h,
						Color.rgb(originalRed, originalGreen, newBlue));
			}
		}
		
		return filtered;
	}
}
